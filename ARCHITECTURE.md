# ğŸ—ï¸ Kiáº¿n TrÃºc Há»‡ Thá»‘ng Y Hotel

## ğŸ¯ Tá»•ng quan Kiáº¿n trÃºc

Y Hotel lÃ  há»‡ thá»‘ng Ä‘áº·t phÃ²ng khÃ¡ch sáº¡n Ä‘Æ°á»£c xÃ¢y dá»±ng theo kiáº¿n trÃºc **Full-Stack Serverless** vá»›i Next.js 15, Supabase, vÃ  PostgreSQL.

---

## ğŸ“Š SÆ¡ Ä‘á»“ Kiáº¿n trÃºc Tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            Y HOTEL SYSTEM                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Frontend      â”‚    â”‚   API Routes    â”‚    â”‚   Database      â”‚         â”‚
â”‚  â”‚   Next.js 15    â”‚â—„â”€â”€â–ºâ”‚   Next.js API   â”‚â—„â”€â”€â–ºâ”‚   Supabase      â”‚         â”‚
â”‚  â”‚   React 18      â”‚    â”‚   Serverless    â”‚    â”‚   PostgreSQL    â”‚         â”‚
â”‚  â”‚   TypeScript    â”‚    â”‚   Functions     â”‚    â”‚   + Auth        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                       â”‚                       â”‚                â”‚
â”‚           â–¼                       â–¼                       â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   User Browser  â”‚    â”‚   Payment       â”‚    â”‚   File Storage  â”‚         â”‚
â”‚  â”‚   Mobile/Web    â”‚â—„â”€â”€â–ºâ”‚   SEPAY Webhook â”‚    â”‚   Supabase      â”‚         â”‚
â”‚  â”‚   Responsive    â”‚    â”‚   Integration   â”‚    â”‚   Storage       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  External Services: SEPAY, Email Service, CDN, Monitoring                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›ï¸ Kiáº¿n trÃºc Chi tiáº¿t

### ğŸ¨ Frontend Architecture

```
Frontend Layer
â”œâ”€â”€ ğŸ“± User Interface (React Components)
â”‚   â”œâ”€â”€ ğŸ  Pages (Next.js App Router)
â”‚   â”‚   â”œâ”€â”€ / (HomePage)
â”‚   â”‚   â”œâ”€â”€ /rooms (RoomListing)
â”‚   â”‚   â”œâ”€â”€ /rooms/[id] (RoomDetail)
â”‚   â”‚   â”œâ”€â”€ /book (BookingFlow)
â”‚   â”‚   â”œâ”€â”€ /checkout (PaymentFlow)
â”‚   â”‚   â”œâ”€â”€ /lookup (BookingLookup)
â”‚   â”‚   â””â”€â”€ /blog (BlogSystem)
â”‚   â”œâ”€â”€ ğŸ§© Components
â”‚   â”‚   â”œâ”€â”€ ui/ (shadcn/ui)
â”‚   â”‚   â”œâ”€â”€ BookingSection.tsx
â”‚   â”‚   â”œâ”€â”€ RoomCard.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ğŸ¨ Styling (Tailwind CSS)
â”œâ”€â”€ ğŸ”„ State Management
â”‚   â”œâ”€â”€ TanStack Query (Data Fetching)
â”‚   â”œâ”€â”€ React Hook Form (Forms)
â”‚   â””â”€â”€ Context API (Global State)
â””â”€â”€ ğŸ› ï¸ Utilities
    â”œâ”€â”€ API Client (Supabase)
    â”œâ”€â”€ Validation (Zod)
    â””â”€â”€ Helpers (Date, Currency, etc.)
```

### ğŸ”§ Backend Architecture

```
Backend Layer (Serverless Functions)
â”œâ”€â”€ ğŸ›£ï¸ API Routes (/api/*)
â”‚   â”œâ”€â”€ ğŸ“… Bookings API
â”‚   â”‚   â”œâ”€â”€ GET /api/bookings (List bookings)
â”‚   â”‚   â”œâ”€â”€ POST /api/bookings (Create booking)
â”‚   â”‚   â”œâ”€â”€ GET /api/bookings/[id] (Get booking)
â”‚   â”‚   â”œâ”€â”€ PATCH /api/bookings/[id] (Update booking)
â”‚   â”‚   â””â”€â”€ GET /api/bookings/lookup (Public lookup)
â”‚   â”œâ”€â”€ ğŸ¨ Rooms API
â”‚   â”‚   â”œâ”€â”€ GET /api/rooms (List rooms)
â”‚   â”‚   â”œâ”€â”€ GET /api/rooms/[id] (Get room)
â”‚   â”‚   â”œâ”€â”€ POST /api/rooms (Create room)
â”‚   â”‚   â”œâ”€â”€ PATCH /api/rooms/[id] (Update room)
â”‚   â”‚   â””â”€â”€ GET /api/rooms/available (Check availability)
â”‚   â”œâ”€â”€ ğŸ‘¥ Customers API
â”‚   â”‚   â”œâ”€â”€ GET /api/customers (List customers)
â”‚   â”‚   â”œâ”€â”€ POST /api/customers (Create customer)
â”‚   â”‚   â””â”€â”€ GET /api/customers/[id] (Get customer)
â”‚   â”œâ”€â”€ ğŸ“Š Dashboard API
â”‚   â”‚   â””â”€â”€ GET /api/dashboard (Analytics)
â”‚   â”œâ”€â”€ ğŸ–¼ï¸ Images API
â”‚   â”‚   â”œâ”€â”€ POST /api/images (Upload image)
â”‚   â”‚   â””â”€â”€ GET /api/images (List images)
â”‚   â””â”€â”€ ğŸ”” Webhooks API
â”‚       â””â”€â”€ POST /api/webhooks/sepay (Payment webhook)
â”œâ”€â”€ ğŸ—„ï¸ Database Layer
â”‚   â”œâ”€â”€ Supabase Client (Server)
â”‚   â”œâ”€â”€ Query Builder
â”‚   â””â”€â”€ Connection Pooling
â””â”€â”€ ğŸ” Security & Auth
    â”œâ”€â”€ API Key Authentication
    â”œâ”€â”€ Request Validation
    â””â”€â”€ Rate Limiting
```

### ğŸ’¾ Database Architecture

```
Database Layer (PostgreSQL + Supabase)
â”œâ”€â”€ ğŸ“‹ Core Tables
â”‚   â”œâ”€â”€ rooms (Room information)
â”‚   â”œâ”€â”€ customers (Customer data)
â”‚   â”œâ”€â”€ bookings (Booking records)
â”‚   â”œâ”€â”€ payments (Payment transactions)
â”‚   â”œâ”€â”€ images (File metadata)
â”‚   â”œâ”€â”€ room_images (Room-image relations)
â”‚   â””â”€â”€ blogs (Content management)
â”œâ”€â”€ ğŸ”— Relationships
â”‚   â”œâ”€â”€ bookings â†’ customers (Many-to-One)
â”‚   â”œâ”€â”€ bookings â†’ rooms (Many-to-One)
â”‚   â”œâ”€â”€ payments â†’ bookings (Many-to-One)
â”‚   â”œâ”€â”€ room_images â†’ rooms (Many-to-One)
â”‚   â””â”€â”€ room_images â†’ images (Many-to-One)
â”œâ”€â”€ ğŸ” Indexes
â”‚   â”œâ”€â”€ Date range indexes (check_in, check_out)
â”‚   â”œâ”€â”€ Status indexes (booking_status, room_status)
â”‚   â”œâ”€â”€ Foreign key indexes
â”‚   â””â”€â”€ Full-text search indexes
â””â”€â”€ âš¡ Performance Features
    â”œâ”€â”€ Row Level Security (RLS)
    â”œâ”€â”€ Database Functions
    â”œâ”€â”€ Triggers & Views
    â””â”€â”€ Query Optimization
```

---

## ğŸ”„ Data Flow Diagrams

### ğŸ¨ Room Booking Flow

```
1. User browses rooms
   â†“
2. User selects room & dates
   â†“
3. Frontend validates availability
   â†“
4. API checks room conflicts
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  SELECT COUNT(*) FROM bookings      â”‚
   â”‚  WHERE room_id = ?                  â”‚
   â”‚  AND status IN ('confirmed', ...)   â”‚
   â”‚  AND check_in < ? AND check_out > ? â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
5. If available â†’ Create booking
   â†“
6. Database transaction:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  BEGIN TRANSACTION                  â”‚
   â”‚  INSERT INTO customers (...)        â”‚
   â”‚  INSERT INTO bookings (...)         â”‚
   â”‚  INSERT INTO payments (...)         â”‚
   â”‚  COMMIT                             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
7. Return booking confirmation
   â†“
8. Email notification sent
```

### ğŸ’° Payment Processing Flow

```
1. User completes booking
   â†“
2. User chooses payment method
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Bank Transfer (Recommended)       â”‚
   â”‚  Pay at Hotel (Alternative)        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
3. For Bank Transfer:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Generate QR Code                   â”‚
   â”‚  Display payment info               â”‚
   â”‚  Booking status: awaiting_payment   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
4. User makes payment via SEPAY
   â†“
5. SEPAY sends webhook to /api/webhooks/sepay
   â†“
6. Webhook handler validates signature
   â†“
7. Update payment status to 'paid'
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  UPDATE payments                    â”‚
   â”‚  SET payment_status = 'paid',      â”‚
   â”‚      paid_at = NOW()                â”‚
   â”‚  WHERE id = ?                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
8. Update booking status to 'confirmed'
   â†“
9. Send confirmation email
   â†“
10. Redirect to success page
```

### ğŸ“Š Dashboard Analytics Flow

```
1. Admin requests dashboard data
   â†“
2. API validates authentication
   â†“
3. Query multiple tables in parallel
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Room statistics:                   â”‚
   â”‚  SELECT status, COUNT(*) FROM rooms â”‚
   â”‚  GROUP BY status                    â”‚
   â”‚                                     â”‚
   â”‚  Booking statistics:                â”‚
   â”‚  SELECT status, COUNT(*) FROM bookingsâ”‚
   â”‚  WHERE created_at >= ? AND <= ?     â”‚
   â”‚  GROUP BY status                    â”‚
   â”‚                                     â”‚
   â”‚  Revenue calculations:              â”‚
   â”‚  SELECT SUM(total_amount) FROM bookingsâ”‚
   â”‚  WHERE status = 'completed'         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
4. Aggregate data by time periods
   â†“
5. Generate chart data (if requested)
   â†“
6. Return JSON response
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  {                                  â”‚
   â”‚    "rooms": {...},                  â”‚
   â”‚    "bookings": {...},               â”‚
   â”‚    "revenue": {...},                â”‚
   â”‚    "occupancy_rate": 85.5           â”‚
   â”‚  }                                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¢ Component Architecture

### ğŸ¯ Frontend Component Structure

```
src/components/
â”œâ”€â”€ ğŸ“± Layout Components
â”‚   â”œâ”€â”€ Navigation.tsx (Header & Menu)
â”‚   â”œâ”€â”€ Footer.tsx (Footer content)
â”‚   â””â”€â”€ Providers.tsx (Context providers)
â”œâ”€â”€ ğŸ  Page Components
â”‚   â”œâ”€â”€ HeroSection.tsx (Homepage hero)
â”‚   â”œâ”€â”€ RoomsSection.tsx (Room listing)
â”‚   â”œâ”€â”€ BookingSection.tsx (Booking form)
â”‚   â””â”€â”€ GallerySection.tsx (Image gallery)
â”œâ”€â”€ ğŸ§© Reusable Components
â”‚   â”œâ”€â”€ ui/ (shadcn/ui components)
â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â””â”€â”€ Dialog.tsx
â”‚   â”œâ”€â”€ RoomCard.tsx (Room display card)
â”‚   â”œâ”€â”€ BookingStatusBadge.tsx (Status indicator)
â”‚   â””â”€â”€ LoadingSkeleton.tsx (Loading states)
â””â”€â”€ ğŸ¨ Styling
    â””â”€â”€ index.css (Global styles)
```

### ğŸ”§ API Route Structure

```
src/app/api/
â”œâ”€â”€ ğŸ“… bookings/
â”‚   â”œâ”€â”€ route.ts (GET, POST)
â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â””â”€â”€ route.ts (GET, PATCH, DELETE)
â”‚   â””â”€â”€ lookup/
â”‚       â””â”€â”€ route.ts (GET)
â”œâ”€â”€ ğŸ¨ rooms/
â”‚   â”œâ”€â”€ route.ts (GET, POST)
â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â””â”€â”€ route.ts (GET, PATCH, DELETE)
â”‚   â””â”€â”€ available/
â”‚       â””â”€â”€ route.ts (GET)
â”œâ”€â”€ ğŸ‘¥ customers/
â”‚   â”œâ”€â”€ route.ts (GET, POST)
â”‚   â””â”€â”€ [id]/
â”‚       â””â”€â”€ route.ts (GET, PATCH, DELETE)
â”œâ”€â”€ ğŸ“Š dashboard/
â”‚   â””â”€â”€ route.ts (GET)
â”œâ”€â”€ ğŸ–¼ï¸ images/
â”‚   â”œâ”€â”€ route.ts (POST)
â”‚   â””â”€â”€ [id]/
â”‚       â””â”€â”€ route.ts (DELETE)
â””â”€â”€ ğŸ”” webhooks/
    â””â”€â”€ sepay/
        â””â”€â”€ route.ts (POST)
```

---

## ğŸ” Security Architecture

### ğŸ›¡ï¸ Security Layers

```
Security Architecture
â”œâ”€â”€ ğŸŒ Network Security
â”‚   â”œâ”€â”€ HTTPS/TLS Encryption
â”‚   â”œâ”€â”€ CORS Configuration
â”‚   â””â”€â”€ Rate Limiting
â”œâ”€â”€ ğŸ”‘ Authentication
â”‚   â”œâ”€â”€ API Key Authentication
â”‚   â”œâ”€â”€ Supabase Auth (Future)
â”‚   â””â”€â”€ Request Signing
â”œâ”€â”€ ğŸ“Š Data Protection
â”‚   â”œâ”€â”€ Input Validation (Zod)
â”‚   â”œâ”€â”€ SQL Injection Prevention
â”‚   â””â”€â”€ XSS Protection
â”œâ”€â”€ ğŸ—„ï¸ Database Security
â”‚   â”œâ”€â”€ Row Level Security (RLS)
â”‚   â”œâ”€â”€ Parameterized Queries
â”‚   â””â”€â”€ Access Control
â””â”€â”€ ğŸ”’ Application Security
    â”œâ”€â”€ CSRF Protection
    â”œâ”€â”€ Secure Headers
    â””â”€â”€ Audit Logging
```

### ğŸ”„ Request Flow Security

```
Client Request â†’ API Route
       â†“
Validate API Key / Auth Token
       â†“
Input Validation (Zod Schema)
       â†“
Sanitize User Input
       â†“
Database Query (Parameterized)
       â†“
RLS Policy Check
       â†“
Data Processing
       â†“
Response Formatting
       â†“
Audit Logging
       â†“
Send Response
```

---

## ğŸ“ˆ Performance Architecture

### âš¡ Performance Optimization Layers

```
Performance Architecture
â”œâ”€â”€ ğŸŒ Frontend Optimization
â”‚   â”œâ”€â”€ Code Splitting (Dynamic Imports)
â”‚   â”œâ”€â”€ Image Optimization (Next.js Image)
â”‚   â”œâ”€â”€ Bundle Analysis
â”‚   â””â”€â”€ Caching (Service Worker)
â”œâ”€â”€ ğŸš€ API Optimization
â”‚   â”œâ”€â”€ Database Indexing
â”‚   â”œâ”€â”€ Query Optimization
â”‚   â”œâ”€â”€ Caching (Redis - Future)
â”‚   â””â”€â”€ CDN Integration
â”œâ”€â”€ ğŸ’¾ Database Optimization
â”‚   â”œâ”€â”€ Connection Pooling
â”‚   â”œâ”€â”€ Query Planning
â”‚   â”œâ”€â”€ Index Optimization
â”‚   â””â”€â”€ Partitioning Strategy
â””â”€â”€ ğŸ“Š Monitoring & Analytics
    â”œâ”€â”€ Performance Metrics
    â”œâ”€â”€ Error Tracking
    â””â”€â”€ User Experience Monitoring
```

### ğŸ” Database Query Optimization

```
Query Optimization Strategy
â”œâ”€â”€ ğŸ“Š Index Strategy
â”‚   â”œâ”€â”€ Primary Keys (Automatic)
â”‚   â”œâ”€â”€ Foreign Keys (Automatic)
â”‚   â”œâ”€â”€ Date Range Indexes
â”‚   â”œâ”€â”€ Status Indexes
â”‚   â””â”€â”€ Composite Indexes
â”œâ”€â”€ ğŸ” Query Patterns
â”‚   â”œâ”€â”€ SELECT with WHERE clauses
â”‚   â”œâ”€â”€ JOIN optimization
â”‚   â”œâ”€â”€ Subquery elimination
â”‚   â””â”€â”€ View materialization
â””â”€â”€ ğŸ“ˆ Performance Monitoring
    â”œâ”€â”€ EXPLAIN ANALYZE
    â”œâ”€â”€ Query execution time
    â”œâ”€â”€ Index usage statistics
    â””â”€â”€ Slow query logs
```

---

## ğŸ”„ Integration Architecture

### ğŸ’° Payment Integration (SEPAY)

```
SEPAY Integration Flow
â”œâ”€â”€ ğŸ“± User initiates payment
â”‚   â†“
â”œâ”€â”€ ğŸ¯ Generate payment QR code
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚  QR Code contains:                  â”‚
â”‚   â”‚  - Bank account info                â”‚
â”‚   â”‚  - Amount                           â”‚
â”‚   â”‚  - Transfer content (booking code)  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â†“
â”œâ”€â”€ ğŸ’³ User scans QR and pays
â”‚   â†“
â””â”€â”€ ğŸ”” SEPAY webhook notification
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  POST /api/webhooks/sepay           â”‚
    â”‚  Headers:                           â”‚
    â”‚  - X-SEPAY-Signature                â”‚
    â”‚  Body:                              â”‚
    â”‚  - transaction_id                   â”‚
    â”‚  - amount                           â”‚
    â”‚  - content                          â”‚
    â”‚  - timestamp                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    Webhook Processing
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  1. Verify signature                â”‚
    â”‚  2. Find booking by code            â”‚
    â”‚  3. Update payment status           â”‚
    â”‚  4. Update booking status           â”‚
    â”‚  5. Send confirmation email         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“§ Email Integration (Future)

```
Email Service Integration
â”œâ”€â”€ ğŸ“§ Trigger events
â”‚   â”œâ”€â”€ Booking created
â”‚   â”œâ”€â”€ Payment received
â”‚   â”œâ”€â”€ Booking confirmed
â”‚   â””â”€â”€ Check-in reminder
â”‚   â†“
â”œâ”€â”€ ğŸ“ Template rendering
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚  Handlebars templates              â”‚
â”‚   â”‚  - booking-confirmation.hbs        â”‚
â”‚   â”‚  - payment-success.hbs             â”‚
â”‚   â”‚  - checkin-reminder.hbs            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â†“
â”œâ”€â”€ ğŸ“¤ SMTP delivery
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚  SMTP Configuration:                â”‚
â”‚   â”‚  - Host: smtp.gmail.com            â”‚
â”‚   â”‚  - Port: 587                       â”‚
â”‚   â”‚  - Authentication: OAuth2          â”‚
â”‚   â”‚  - TLS: Required                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â†“
â””â”€â”€ ğŸ“Š Delivery tracking
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SendGrid/Mailgun webhooks          â”‚
    â”‚  - Delivered                        â”‚
    â”‚  - Opened                           â”‚
    â”‚  - Clicked                          â”‚
    â”‚  - Bounced                          â”‚
    â”‚  - Complained                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Architecture

### â˜ï¸ Cloud Infrastructure

```
Deployment Architecture
â”œâ”€â”€ ğŸŒ Frontend (Vercel)
â”‚   â”œâ”€â”€ Static Asset Delivery
â”‚   â”œâ”€â”€ CDN Distribution
â”‚   â”œâ”€â”€ Edge Functions
â”‚   â””â”€â”€ Automatic Scaling
â”œâ”€â”€ ğŸ’¾ Database (Supabase)
â”‚   â”œâ”€â”€ PostgreSQL Database
â”‚   â”œâ”€â”€ Automatic Backups
â”‚   â”œâ”€â”€ Point-in-time Recovery
â”‚   â””â”€â”€ Global CDN
â”œâ”€â”€ ğŸ–¼ï¸ File Storage (Supabase Storage)
â”‚   â”œâ”€â”€ Image Upload/Delivery
â”‚   â”œâ”€â”€ CDN Optimization
â”‚   â””â”€â”€ Access Control
â””â”€â”€ ğŸ“Š Monitoring (Vercel Analytics)
    â”œâ”€â”€ Performance Metrics
    â”œâ”€â”€ Error Tracking
    â”œâ”€â”€ User Analytics
    â””â”€â”€ Real-time Monitoring
```

### ğŸ”„ CI/CD Pipeline

```
CI/CD Pipeline
â”œâ”€â”€ ğŸ—ï¸ Build Stage
â”‚   â”œâ”€â”€ Code Checkout
â”‚   â”œâ”€â”€ Dependency Installation
â”‚   â”œâ”€â”€ Type Checking
â”‚   â”œâ”€â”€ Linting
â”‚   â”œâ”€â”€ Unit Tests
â”‚   â””â”€â”€ Build Optimization
â”œâ”€â”€ ğŸ§ª Testing Stage
â”‚   â”œâ”€â”€ Integration Tests
â”‚   â”œâ”€â”€ API Tests
â”‚   â”œâ”€â”€ E2E Tests (Playwright)
â”‚   â””â”€â”€ Performance Tests
â”œâ”€â”€ ğŸš€ Deployment Stage
â”‚   â”œâ”€â”€ Database Migrations
â”‚   â”œâ”€â”€ Asset Upload
â”‚   â”œâ”€â”€ Environment Setup
â”‚   â””â”€â”€ Zero-downtime Deployment
â””â”€â”€ ğŸ“Š Monitoring Stage
    â”œâ”€â”€ Health Checks
    â”œâ”€â”€ Performance Monitoring
    â”œâ”€â”€ Error Alerting
    â””â”€â”€ Rollback Procedures
```

---

## ğŸ“Š Monitoring & Observability

### ğŸ“ˆ Key Metrics

```
Monitoring Dashboard
â”œâ”€â”€ ğŸ“Š Application Metrics
â”‚   â”œâ”€â”€ Response Time (P95, P99)
â”‚   â”œâ”€â”€ Error Rate (%)
â”‚   â”œâ”€â”€ Throughput (RPM)
â”‚   â””â”€â”€ Availability (%)
â”œâ”€â”€ ğŸ’¾ Database Metrics
â”‚   â”œâ”€â”€ Connection Pool Usage
â”‚   â”œâ”€â”€ Query Performance
â”‚   â”œâ”€â”€ Lock Contention
â”‚   â””â”€â”€ Storage Usage
â”œâ”€â”€ ğŸ’° Business Metrics
â”‚   â”œâ”€â”€ Booking Conversion Rate
â”‚   â”œâ”€â”€ Average Order Value
â”‚   â”œâ”€â”€ Customer Acquisition Cost
â”‚   â””â”€â”€ Customer Lifetime Value
â””â”€â”€ ğŸ”§ Infrastructure Metrics
    â”œâ”€â”€ CPU Usage
    â”œâ”€â”€ Memory Usage
    â”œâ”€â”€ Disk I/O
    â””â”€â”€ Network Traffic
```

### ğŸš¨ Alerting Strategy

```
Alerting Rules
â”œâ”€â”€ ğŸ”´ Critical Alerts (Immediate Response)
â”‚   â”œâ”€â”€ API Error Rate > 10%
â”‚   â”œâ”€â”€ Database Connection Failure
â”‚   â”œâ”€â”€ Payment Webhook Failure
â”‚   â””â”€â”€ Security Breach Detected
â”œâ”€â”€ ğŸŸ¡ Warning Alerts (Investigation Required)
â”‚   â”œâ”€â”€ Response Time > 2s
â”‚   â”œâ”€â”€ Memory Usage > 85%
â”‚   â”œâ”€â”€ Disk Space < 20%
â”‚   â””â”€â”€ Failed Payment Rate > 5%
â””â”€â”€ â„¹ï¸ Info Alerts (Monitoring)
    â”œâ”€â”€ New User Registrations
    â”œâ”€â”€ Feature Usage Statistics
    â”œâ”€â”€ Performance Degradation
    â””â”€â”€ System Resource Trends
```

---

## ğŸ”® Scalability Considerations

### ğŸ“ˆ Horizontal Scaling

```
Scalability Architecture
â”œâ”€â”€ ğŸŒ Load Balancing
â”‚   â”œâ”€â”€ DNS-based Load Balancing
â”‚   â”œâ”€â”€ Application Load Balancer
â”‚   â””â”€â”€ CDN Distribution
â”œâ”€â”€ ğŸ’¾ Database Scaling
â”‚   â”œâ”€â”€ Read Replicas
â”‚   â”œâ”€â”€ Connection Pooling
â”‚   â”œâ”€â”€ Query Optimization
â”‚   â””â”€â”€ Database Sharding (Future)
â”œâ”€â”€ ğŸ“¦ Caching Strategy
â”‚   â”œâ”€â”€ Application-level Caching
â”‚   â”œâ”€â”€ Database Query Caching
â”‚   â”œâ”€â”€ CDN Caching
â”‚   â””â”€â”€ Redis Caching (Future)
â””â”€â”€ ğŸ”„ Asynchronous Processing
    â”œâ”€â”€ Background Job Processing
    â”œâ”€â”€ Email Queue
    â”œâ”€â”€ Image Processing
    â””â”€â”€ Analytics Processing
```

### ğŸ¯ Performance Benchmarks

```
Performance Targets
â”œâ”€â”€ ğŸ“± Frontend Performance
â”‚   â”œâ”€â”€ First Contentful Paint: < 1.5s
â”‚   â”œâ”€â”€ Largest Contentful Paint: < 2.5s
â”‚   â”œâ”€â”€ First Input Delay: < 100ms
â”‚   â””â”€â”€ Cumulative Layout Shift: < 0.1
â”œâ”€â”€ ğŸš€ API Performance
â”‚   â”œâ”€â”€ Average Response Time: < 500ms
â”‚   â”œâ”€â”€ 95th Percentile: < 1s
â”‚   â”œâ”€â”€ Error Rate: < 1%
â”‚   â””â”€â”€ Availability: > 99.9%
â””â”€â”€ ğŸ’¾ Database Performance
    â”œâ”€â”€ Query Response Time: < 100ms
    â”œâ”€â”€ Connection Pool Efficiency: > 90%
    â”œâ”€â”€ Index Hit Rate: > 95%
    â””â”€â”€ Cache Hit Rate: > 80%
```

---

## ğŸ“‹ Conclusion

Kiáº¿n trÃºc cá»§a Y Hotel Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ Ä‘áº£m báº£o:
- **Scalability**: Dá»… dÃ ng má»Ÿ rá»™ng theo nhu cáº§u
- **Reliability**: Äá»™ tin cáº­y cao vá»›i fault tolerance
- **Security**: Báº£o máº­t toÃ n diá»‡n á»Ÿ má»i layer
- **Performance**: Tá»‘i Æ°u hÃ³a cho tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng
- **Maintainability**: Dá»… báº£o trÃ¬ vÃ  phÃ¡t triá»ƒn thÃªm

**PhiÃªn báº£n:** 1.0.0
**Cáº­p nháº­t láº§n cuá»‘i:** January 2026
**TÃ¡c giáº£:** Y Hotel Development Team